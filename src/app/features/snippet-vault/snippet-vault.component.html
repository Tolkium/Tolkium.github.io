<div class="snippet-vault-container">
  <div class="container mx-auto px-4 py-2 md:px-6 md:py-4 max-w-7xl">
    <!-- Terminal-style Header -->
    <header class="terminal-header mb-6 bg-white/50 dark:bg-slate-800/50 backdrop-blur-[10px] rounded-xl border border-slate-200/50 dark:border-slate-700/50 shadow-lg overflow-hidden">
      <div class="terminal-bar flex items-center gap-3 px-4 py-3 bg-slate-100/50 dark:bg-slate-900/30 border-b border-slate-200/50 dark:border-slate-700/50">
        <div class="flex gap-2">
          <span class="w-3 h-3 rounded-full bg-red-400"></span>
          <span class="w-3 h-3 rounded-full bg-yellow-400"></span>
          <span class="w-3 h-3 rounded-full bg-green-400"></span>
        </div>
        <span class="flex-1 text-center text-xs font-mono text-slate-500 dark:text-slate-400">snippet-vault@portfolio:~</span>
      </div>
      <div class="terminal-content p-6 md:p-8">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
          <!-- Left: Title & Subtitle -->
          <div class="header-content">
            <h1 class="vault-title">
              <ng-icon name="heroArchiveBox" class="title-icon"></ng-icon>
              Snippet Vault
            </h1>
            <p class="vault-subtitle">Your personal code library</p>
          </div>
          <!-- Right: Actions -->
          <div class="header-actions">
            @if (!hasSelection()) {
              <div class="search-wrapper">
                <ng-icon name="heroMagnifyingGlass" class="search-icon"></ng-icon>
                <input
                  type="text"
                  class="search-input"
                  [value]="searchQuery()"
                  (input)="searchQuery.set($any($event.target).value)"
                  placeholder="Search snippets..."
                  aria-label="Search snippets"
                />
              </div>
            }
            @if (!hasSelection()) {
              <button
                class="create-btn"
                (click)="onCreateNew()"
                type="button"
                aria-label="Create new snippet"
              >
                <ng-icon name="heroPlus" class="icon"></ng-icon>
                New Snippet
              </button>
            }
          </div>
        </div>
      </div>
    </header>
  </div>

  <div class="vault-content">
    <!-- World View - Snippet Grid -->
    <div class="world-view" [class.hidden]="hasSelection()">
      @if (filteredSnippets().length === 0) {
        <div class="empty-state">
          <ng-icon name="heroArchiveBox" class="empty-icon"></ng-icon>
          <h2 class="empty-title">
            @if (searchQuery()) {
              No snippets found
            } @else {
              Your vault is empty
            }
          </h2>
          <p class="empty-description">
            @if (searchQuery()) {
              Try a different search term
            } @else {
              Create your first snippet to get started
            }
          </p>
          @if (!searchQuery()) {
            <button
              class="empty-action-btn"
              (click)="onCreateNew()"
              type="button"
            >
              <ng-icon name="heroPlus" class="icon"></ng-icon>
              Create First Snippet
            </button>
          }
        </div>
      } @else {
        <div class="snippets-grid">
          @for (snippet of filteredSnippets(); track snippet.id) {
            <app-snippet-card
              [snippet]="snippet"
              [selected]="selectedSnippetId() === snippet.id"
              (cardClick)="onSnippetClick($event)"
              (editClick)="onSnippetEdit($event)"
              (deleteClick)="onSnippetDelete($event)"
            />
          }
        </div>
      }
    </div>

    <!-- Editor View -->
    <div class="editor-view" [class.hidden]="!hasSelection()">
      <div class="editor-view-header">
        <!-- Top Row: Back button, Title, Actions -->
        <div class="header-top-row">
          <button
            class="back-btn"
            (click)="onCancelEdit()"
            type="button"
            aria-label="Back to snippets"
          >
            <ng-icon name="heroArrowLeft" class="icon-sm"></ng-icon>
          </button>

          <div class="title-section">
            <input
              type="text"
              class="editable-title"
              [value]="currentTitle() || ''"
              (input)="onTitleChange($any($event.target).value)"
              (blur)="onTitleBlur()"
              placeholder="Untitled snippet"
              aria-label="Snippet title"
            />
          </div>

          <div class="editor-view-actions">
            <button
              class="console-icon-btn"
              (click)="toggleConsole()"
              type="button"
              [class.active]="showConsole()"
              [attr.aria-label]="showConsole() ? 'Hide console' : 'Show console'"
              title="Toggle Console"
            >
              <ng-icon name="heroCommandLine" class="icon-sm"></ng-icon>
            </button>
          </div>
        </div>

        <!-- Middle Row: Description -->
        <div class="header-middle-row">
          @if (currentDescription() || isEditingDescription()) {
            <textarea
              class="editable-description"
              [value]="currentDescription()"
              (input)="onDescriptionChange($any($event.target).value)"
              (blur)="onDescriptionBlur()"
              placeholder="Add a description..."
              rows="1"
              aria-label="Snippet description"
            ></textarea>
          } @else {
            <button
              class="add-description-btn"
              (click)="startEditingDescription()"
              type="button"
              aria-label="Add description"
            >
              <ng-icon name="heroPlus" class="icon-xs"></ng-icon>
              <span>Add description</span>
            </button>
          }
        </div>

        <!-- Bottom Row: Tags + Save Button -->
        <div class="header-tags-row">
          <div class="tags-container">
            @for (tag of currentTags(); track tag) {
              <span class="tag-chip">
                {{ tag }}
                <button
                  class="tag-remove-btn"
                  (click)="removeTag(tag)"
                  type="button"
                  [attr.aria-label]="'Remove tag ' + tag"
                >
                  Ã—
                </button>
              </span>
            }
            <input
              type="text"
              class="tag-input"
              [value]="newTag()"
              (input)="newTag.set($any($event.target).value)"
              (keydown)="onTagKeydown($event)"
              placeholder="+ Add tag"
              aria-label="Add a tag"
            />
          </div>
          <button
            class="header-save-btn"
            (click)="onSaveSnippet()"
            type="button"
            [disabled]="!currentTitle().trim()"
            aria-label="Save snippet"
          >
            <ng-icon name="heroArrowDownTray" class="icon-sm"></ng-icon>
            <span>Save</span>
          </button>
        </div>
      </div>

      <div class="editor-layout">
        <!-- Left: Editor -->
        <div class="editor-panel">
          <app-snippet-editor
            [html]="currentHtml()"
            [css]="currentCss()"
            [javascript]="currentJavascript()"
            (htmlChange)="onHtmlChange($event)"
            (cssChange)="onCssChange($event)"
            (javascriptChange)="onJavascriptChange($event)"
          />
        </div>

        <!-- Right: Preview and Console -->
        <div class="preview-panel">
          <div class="preview-section">
            <app-live-preview
              [html]="currentHtml()"
              [css]="currentCss()"
              [javascript]="currentJavascript()"
              (consoleMessages)="onConsoleMessages($event)"
            />
          </div>

          @if (showConsole()) {
            <div class="console-section">
              <app-console-panel
                [messages]="consoleMessages()"
                [visible]="showConsole()"
                (clearRequested)="consoleMessages.set([])"
              />
            </div>
          }
        </div>
      </div>

    </div>
  </div>
</div>

