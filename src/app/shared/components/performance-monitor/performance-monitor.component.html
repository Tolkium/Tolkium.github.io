<div #overlay class="performance-overlay" [class.minimized]="isMinimized" [class.dark-mode]="isDarkMode" [class.light-mode]="!isDarkMode">
  <!-- Glassmorphic container -->
  <div class="glass-container">
    <!-- Header -->
    <div class="perf-header">
      <div class="header-content">
        <div class="title-section">
          <div class="status-indicator" [style.background]="statusColor"></div>
          <h3 class="title">Performance Monitor</h3>
        </div>
        <div class="header-actions">
          <button class="icon-btn" (click)="toggleMinimize()" [attr.aria-label]="isMinimized ? 'Expand' : 'Minimize'">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path *ngIf="!isMinimized" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              <path *ngIf="isMinimized" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
            </svg>
          </button>
          <button class="icon-btn close-btn" (click)="close()" aria-label="Close">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="perf-content" *ngIf="!isMinimized && metrics">
      <!-- FPS Section -->
      <div class="metric-section">
        <div class="metric-header">
          <span class="metric-label">FPS</span>
          <span class="metric-value" [class.critical]="metrics.fps < 24" [class.warning]="metrics.fps >= 24 && metrics.fps < 45">
            {{ metrics.fps }}
          </span>
        </div>
        <canvas #fpsChart class="mini-chart" width="300" height="35"></canvas>
        <div class="metric-info">
          <span class="info-text">Target: 60</span>
        </div>
      </div>

      <!-- Memory Section -->
      <div class="metric-section" *ngIf="metrics.memory">
        <div class="metric-header">
          <span class="metric-label">Memory</span>
          <span class="metric-value" [class.critical]="metrics.memory.usagePercent > 90" [class.warning]="metrics.memory.usagePercent > 75">
            {{ formatBytes(metrics.memory.usedMB) }}
          </span>
        </div>
        <canvas #memoryChart class="mini-chart" width="300" height="35"></canvas>
        <div class="metric-info">
          <span class="info-text">{{ formatPercent(metrics.memory.usagePercent) }} / {{ formatBytes(metrics.memory.limitMB) }}</span>
        </div>
      </div>

      <!-- Memory N/A -->
      <div class="metric-section metric-na" *ngIf="!metrics.memory">
        <div class="metric-header">
          <span class="metric-label">Memory</span>
          <span class="metric-value">N/A</span>
        </div>
        <div class="metric-info">
          <span class="info-text">Chrome/Edge only</span>
        </div>
      </div>

      <!-- CPU Section -->
      <div class="metric-section">
        <div class="metric-header">
          <span class="metric-label">CPU (Est.)</span>
          <span class="metric-value" [class.critical]="metrics.cpu.estimatedUsage > 90" [class.warning]="metrics.cpu.estimatedUsage > 75">
            {{ metrics.cpu.estimatedUsage }}%
          </span>
        </div>
        <canvas #cpuChart class="mini-chart" width="300" height="35"></canvas>
        <div class="metric-info">
          <span class="info-text">Frame: {{ metrics.cpu.averageFrameTime }}ms</span>
          <span class="info-text" *ngIf="metrics.cpu.longTaskCount > 0">Tasks: {{ metrics.cpu.longTaskCount }}</span>
        </div>
      </div>

      <!-- Angular Change Detection Section -->
      <div class="metric-section angular-section">
        <div class="metric-header">
          <span class="metric-label">
            <svg class="inline-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            Change Detection
          </span>
          <span class="metric-value" [class.warning]="metrics.angular.changeDetectionTime > 16" [class.critical]="metrics.angular.changeDetectionTime > 32">
            {{ metrics.angular.changeDetectionCycles }}
          </span>
        </div>
        <canvas #changeDetectionChart class="mini-chart" width="300" height="35"></canvas>
        <div class="metric-info">
          <span class="info-text">CD: {{ metrics.angular.changeDetectionTime.toFixed(1) }}ms</span>
          <span class="info-text" *ngIf="metrics.angular.changeDetectionTime > 16" class="warning-text">⚠️ Slow</span>
        </div>
      </div>

      <!-- DOM & Browser Stats Section -->
      <div class="metric-section stats-grid">
        <div class="stat-item">
          <span class="stat-label">DOM Nodes</span>
          <span class="stat-value">{{ metrics.dom.nodeCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Event Listeners</span>
          <span class="stat-value">{{ metrics.dom.listenerCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Active Effects</span>
          <span class="stat-value">{{ metrics.activeEffects }}/3</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">CPU Threads</span>
          <span class="stat-value">{{ hardwareConcurrency }}</span>
        </div>
      </div>

      <!-- Angular Stats Section -->
      <div class="metric-section stats-grid angular-stats">
        <div class="stat-item">
          <span class="stat-label">
            <svg class="tiny-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            </svg>
            Components
          </span>
          <span class="stat-value angular-highlight">{{ metrics.angular.componentCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Zone Tasks</span>
          <span class="stat-value angular-highlight">{{ metrics.angular.zoneTasksExecuted }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Events Fired</span>
          <span class="stat-value angular-highlight">{{ metrics.angular.eventListenersTriggered }}</span>
        </div>
        <div class="stat-item" *ngIf="metrics.angular.lastRouteChangeTime > 0">
          <span class="stat-label">Route Load</span>
          <span class="stat-value angular-highlight">{{ metrics.angular.lastRouteChangeTime.toFixed(0) }}ms</span>
        </div>
      </div>

      <!-- Network Stats Section -->
      <div class="metric-section stats-grid">
        <div class="stat-item">
          <span class="stat-label">Network Requests</span>
          <span class="stat-value">{{ metrics.network.requestCount }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Transferred</span>
          <span class="stat-value">{{ metrics.network.transferredKB }} KB</span>
        </div>
      </div>

      <!-- Paint Metrics -->
      <div class="metric-section stats-grid" *ngIf="metrics.paint.fcp || metrics.paint.lcp">
        <div class="stat-item" *ngIf="metrics.paint.fcp">
          <span class="stat-label">FCP</span>
          <span class="stat-value">{{ (metrics.paint.fcp / 1000).toFixed(2) }}s</span>
        </div>
        <div class="stat-item" *ngIf="metrics.paint.lcp">
          <span class="stat-label">LCP</span>
          <span class="stat-value">{{ (metrics.paint.lcp / 1000).toFixed(2) }}s</span>
        </div>
      </div>

      <!-- Current Route -->
      <div class="metric-section">
        <div class="route-info">
          <span class="route-label">Route:</span>
          <span class="route-path">{{ metrics.currentRoute }}</span>
        </div>
      </div>

      <!-- Keyboard Shortcut Hint -->
      <div class="shortcut-hint">
        <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> to toggle
      </div>
    </div>

    <!-- Minimized State -->
    <div class="perf-minimized" *ngIf="isMinimized && metrics">
      <div class="mini-stats">
        <div class="mini-stat" [style.color]="metrics.fps < 30 ? '#ef4444' : '#10b981'">
          <span class="mini-label">FPS</span>
          <span class="mini-value">{{ metrics.fps }}</span>
        </div>
        <div class="mini-stat" *ngIf="metrics.memory">
          <span class="mini-label">MEM</span>
          <span class="mini-value">{{ metrics.memory.usedMB.toFixed(0) }}MB</span>
        </div>
        <div class="mini-stat">
          <span class="mini-label">CPU</span>
          <span class="mini-value">{{ metrics.cpu.estimatedUsage }}%</span>
        </div>
      </div>
    </div>

    <!-- Holographic border effect -->
    <div class="holographic-border"></div>
  </div>
</div>

